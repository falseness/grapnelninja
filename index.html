<!Doctype html>
<html>
    <head>
        <title>grapnel ninja</title>
        <meta charset = "UTF-8">
        <style>
            body 
            {
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: 0;
            }
        </style>
    </head>
    <body>
        <canvas id = "canvas"></canvas>
        <script src = "gameoptions.js"></script>
        <script src = 'menu.js'></script>    
    
        <script src = "collision/circlewithcircle.js"></script>
        <script src = "collision/linewithline.js"></script>
        <script src = "collision/circlewithline.js"></script>
        
        <script src = "elements/factory.js"></script>
        <script src = "sprites/floor.js"></script>
        
        <script src = "sprites/empty.js"></script>
        <script src = "sprites/element.js"></script>
        
        <script src = "sprites/ninja.js"></script>
        <script src = "sprites/grapnel.js"></script>
        
        <script src = "sprites/rect.js"></script>
        <script src = "sprites/jumpingcube.js"></script>
        
        <script src = "sprites/create.js"></script>

        <script src = "sprites/triangle.js"></script>
        <script src = "sprites/trampoline.js"></script>
        <script src = "sprites/side.js"></script>
        
        <script src = "physics.js"></script>
        
        <script src = "moveScreen.js"></script>
        
        <script src = "render/draw.js"></script>
        
        <script src = "events.js"></script>
        <script>
            'use strict'
            let canvas = document.getElementById('canvas')
            let ctx = canvas.getContext('2d')
            
            ctx.lineCap = 'butt'
            let trackEnabled = true
            let menu = new Menu(width, height)
            let ninja, grapnel, floors, elementsFactory, screen, ninjaY, screenY
            
            canvas.width = width
            canvas.height = height
            
            window.onload = startGame()
            
            function reStart()
            {
                screen.x = 0
                screen.y = screenY
                grapnel.pos = []
                grapnel.speedX = 0
                grapnel.speedY = 0
                grapnel.throwed = false

                
                ninja.x = 0.2 * width
                ninja.y = ninjaY
                ninja.speedX = 0
                ninja.speedY = 0
                ninja.track.pos = [{x: ninja.x, y: ninja.y}]
                
                scoreText.count = 0
                
                
                
                for (let i = 0; i < floors.length; ++i)
                {
                    floors[i].elements = []

                    floors[i].generatePrimaryElements()
                }
            }
            function startClassicVersion()
            {
                menu.visible = false
                
                elementsFactory = new ElementsFactory
                floors =
                [
                    new SideFloor(0, 0.1 * height, [{type: 'side', chance: 100}]),
                    new Floor(1 * height, 1.9 * height, {min: 0.3 * width, max: 0.3 * width}, 
                    [
                        {type: 'horizontalTopRect' , chance: 20 },
                        {type: 'verticalGroundRect', chance: 20 },
                        {type: 'jumpingCube', chance: 60        }
                        //20 20 40
                    ]),
                    new Floor(0, height, {min: 0.3 * width, max: 0.4 * width},
                    [
                        {type: 'triangle', chance: 100}
                    ]),
                    new SideFloor(0.9 * height, 0, [{type: 'side', chance: 100}])
                ]
                
                screen = new Screen(false)
                
                ninja = new Ninja(
                {
                    x: 0.2 * width,
                    y: 0.2 * height,
                    radius: 0.01 * height,
                    fill: '#0000ff',
                    stroke: '#000000'
                })
                grapnel = new Grapnel(
                {
                    points: [0, 0, 0, 0],
                    stroke: 'red'
                })

                
                for (let i = 0; i < floors.length; ++i)
                {
                    floors[i].generatePrimaryElements()
                }
                
                requestAnimationFrame(gameLoop)
            }
            function startBadVersion()
            {
                menu.visible = false
                
                elementsFactory = new ElementsFactory
                floors =
                [
                    new SideFloor(1.9 * height, 2.4 * height, [{type: 'ground', chance: 100}]),
                    new Floor(1 * height, 1.9 * height, {min: 0.3 * width, max: 0.3 * width}, 
                    [
                        {type: 'horizontalTopRect' , chance: 20 },
                        {type: 'verticalGroundRect', chance: 20 },
                        {type: 'jumpingCube', chance: 60        }
                        //20 20 40
                    ]),
                    new Floor(0, height, {min: 0.3 * width, max: 0.4 * width},
                    [
                        {type: 'triangle', chance: 100}
                    ]),
                    new SideFloor(-0.5 * height, 0, [{type: 'side', chance: 100}])
                ]
                
                screen = new Screen(true, -height)
                
                ninja = new Ninja(
                {
                    x: 0.2 * width,
                    y: 1.2 * height,
                    radius: 0.01 * height,
                    fill: '#0000ff',
                    stroke: '#000000'
                })
                grapnel = new Grapnel(
                {
                    points: [0, 0, 0, 0],
                    stroke: 'red'
                })

                
                for (let i = 0; i < floors.length; ++i)
                {
                    floors[i].generatePrimaryElements()
                }
                
                requestAnimationFrame(gameLoop)
            }
            function startGame()
            {  
                //generatePrimaryElements()
                menu.draw()
                
                
                createEvents()
                
                //requestAnimationFrame(gameLoop)
            }

            function gameLoop()
            {
                //menu.draw()
                physics()
                draw()
                
                requestAnimationFrame(gameLoop)
            }
            
            
            
        </script>
    </body>
</html>